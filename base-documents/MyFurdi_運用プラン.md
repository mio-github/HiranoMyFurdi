# MyFurdi ã‚¢ãƒ—ãƒª - é‹ç”¨ãƒ—ãƒ©ãƒ³

**ä½œæˆæ—¥**: 2025å¹´10æœˆ9æ—¥
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ç›®çš„**: ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã®é‹ç”¨ä½“åˆ¶ã¨ã‚·ã‚¹ãƒ†ãƒ åŸºç›¤ã®æ•´å‚™è¨ˆç”»

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ•ã‚§ãƒ¼ã‚º1ï¼šé‹ç”¨åŸºç›¤æ§‹ç¯‰](#ãƒ•ã‚§ãƒ¼ã‚º1é‹ç”¨åŸºç›¤æ§‹ç¯‰)
2. [ãƒ•ã‚§ãƒ¼ã‚º2ï¼šé‹ç”¨æ‹¡å¼µ](#ãƒ•ã‚§ãƒ¼ã‚º2é‹ç”¨æ‹¡å¼µ)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–)
5. [ç›£è¦–ãƒ»é‹ç”¨ä½“åˆ¶](#ç›£è¦–é‹ç”¨ä½“åˆ¶)

---

## ãƒ•ã‚§ãƒ¼ã‚º1ï¼šé‹ç”¨åŸºç›¤æ§‹ç¯‰

### 1. ãƒªãƒªãƒ¼ã‚¹ä½“åˆ¶

#### ã‚¹ãƒˆã‚¢å…¬é–‹ãƒ—ãƒ­ã‚»ã‚¹

**App Storeï¼ˆiOSï¼‰**
- [ ] Apple Developer Programç™»éŒ²
- [ ] App IDã®ä½œæˆ
- [ ] ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] App Store Connectè¨­å®š
- [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ»ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç´ ææº–å‚™
- [ ] ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»åˆ©ç”¨è¦ç´„æº–å‚™
- [ ] å¯©æŸ»ç”³è«‹ãƒ»å¯¾å¿œãƒ•ãƒ­ãƒ¼ç¢ºç«‹

**Google Playï¼ˆAndroidï¼‰**
- [ ] Google Play Consoleç™»éŒ²
- [ ] ã‚¢ãƒ—ãƒªç½²åéµã®ç”Ÿæˆãƒ»ç®¡ç†
- [ ] ã‚¹ãƒˆã‚¢ãƒªã‚¹ãƒ†ã‚£ãƒ³ã‚°æº–å‚™
- [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ»ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç´ ææº–å‚™
- [ ] ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»åˆ©ç”¨è¦ç´„æº–å‚™
- [ ] å¯©æŸ»ç”³è«‹ãƒ»å¯¾å¿œãƒ•ãƒ­ãƒ¼ç¢ºç«‹

#### ãƒ™ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ 

**ç¤¾å†…ãƒ†ã‚¹ãƒˆï¼ˆWeek 1-2ï¼‰**
- TestFlightï¼ˆiOSï¼‰/ Internal Testingï¼ˆAndroidï¼‰
- å¯¾è±¡: é–‹ç™ºãƒãƒ¼ãƒ ã€ç¤¾å†…ã‚¹ã‚¿ãƒƒãƒ•
- ç›®çš„: åŸºæœ¬æ©Ÿèƒ½ã®å‹•ä½œç¢ºèªã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥æ¤œå‡º

**é™å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ã‚¹ãƒˆï¼ˆWeek 3-4ï¼‰**
- TestFlightï¼ˆiOSï¼‰/ Closed Testingï¼ˆAndroidï¼‰
- å¯¾è±¡: å”åŠ›ä¼šå“¡50ã€œ100å
- ç›®çš„: å®Ÿé‹ç”¨ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†

**ã‚ªãƒ¼ãƒ—ãƒ³ãƒ™ãƒ¼ã‚¿ï¼ˆWeek 5-6ï¼‰**
- TestFlightï¼ˆiOSï¼‰/ Open Testingï¼ˆAndroidï¼‰
- å¯¾è±¡: ä¸€èˆ¬ä¼šå“¡ï¼ˆå¸Œæœ›è€…ï¼‰
- ç›®çš„: å¤§è¦æ¨¡è² è·ãƒ†ã‚¹ãƒˆã€æœ€çµ‚èª¿æ•´

#### å“è³ªç®¡ç†

**ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ¬ãƒãƒ¼ãƒˆåé›†**
- Firebase Crashlytics
- Sentryï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- ç›®æ¨™: ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ç‡ < 1%

**ãƒã‚°ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°**
- GitHub Issues
- Jiraï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- ãƒã‚°å„ªå…ˆåº¦: Critical / High / Medium / Low

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**
- Firebase Performance Monitoring
- ç›®æ¨™:
  - ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚é–“ < 2ç§’
  - ç”»é¢é·ç§»æ™‚é–“ < 300ms
  - APIå¿œç­”æ™‚é–“ < 500ms

---

### 2. ãƒã‚¤ãƒ³ãƒˆåŸºç›¤

#### ã‚µãƒ¼ãƒãƒ¼å´å®Ÿè£…

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**
```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒã‚¤ãƒ³ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE user_points (
  user_id VARCHAR(255) PRIMARY KEY,
  total_points INT DEFAULT 0,
  available_points INT DEFAULT 0,
  pending_points INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ãƒã‚¤ãƒ³ãƒˆå±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE point_history (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id VARCHAR(255),
  action_type VARCHAR(50), -- 'earn', 'redeem', 'expire', 'adjust'
  points INT,
  description TEXT,
  related_id VARCHAR(255), -- é–¢é€£ã™ã‚‹æ´»å‹•IDï¼ˆæ¥é¤¨IDã€ãƒãƒ£ãƒ¬ãƒ³ã‚¸IDãªã©ï¼‰
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_created_at (created_at)
);

-- ãƒã‚¤ãƒ³ãƒˆãƒ«ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE point_rules (
  id INT PRIMARY KEY AUTO_INCREMENT,
  rule_name VARCHAR(100),
  action_type VARCHAR(50), -- 'visit', 'workout', 'challenge', etc.
  points INT,
  is_active BOOLEAN DEFAULT TRUE,
  start_date DATE,
  end_date DATE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### APIè¨­è¨ˆ

**ãƒã‚¤ãƒ³ãƒˆå–å¾—API**
```
GET /api/v1/users/{userId}/points
Response:
{
  "userId": "string",
  "totalPoints": 1000,
  "availablePoints": 800,
  "pendingPoints": 200
}
```

**ãƒã‚¤ãƒ³ãƒˆå±¥æ­´API**
```
GET /api/v1/users/{userId}/points/history
Query: limit, offset, startDate, endDate
Response:
{
  "history": [
    {
      "date": "2025-03-01T10:00:00Z",
      "action": "visit",
      "points": 10,
      "description": "æ¥é¤¨ãƒã‚¤ãƒ³ãƒˆ"
    }
  ],
  "total": 100
}
```

**ãƒã‚¤ãƒ³ãƒˆä»˜ä¸APIï¼ˆå†…éƒ¨ç”¨ï¼‰**
```
POST /api/v1/internal/points/grant
Body:
{
  "userId": "string",
  "actionType": "string",
  "points": 10,
  "description": "string",
  "relatedId": "string"
}
```

#### ä»˜ä¸æ–¹å¼ã®å®Ÿè£…

**æ¡ˆ1: é€æ¬¡ä»˜ä¸æ–¹å¼**
```javascript
// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä»˜ä¸å‡¦ç†
async function grantPointsImmediately(userId, actionType, points) {
  const rule = await getActiveRule(actionType);
  if (!rule) return;

  await db.transaction(async (trx) => {
    // ãƒã‚¤ãƒ³ãƒˆåŠ ç®—
    await trx('user_points')
      .where('user_id', userId)
      .increment('total_points', points)
      .increment('available_points', points);

    // å±¥æ­´è¨˜éŒ²
    await trx('point_history').insert({
      user_id: userId,
      action_type: actionType,
      points: points,
      description: rule.description
    });
  });

  // ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥é€ä¿¡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  await sendNotification(userId, `${points}ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼`);
}
```

**æ¡ˆ2: ãƒãƒƒãƒä¸€æ‹¬è¨ˆç®—æ–¹å¼**
```javascript
// æ—¥æ¬¡ãƒãƒƒãƒå‡¦ç†
async function calculatePointsDaily() {
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);

  // æ˜¨æ—¥ã®æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
  const activities = await db('user_activities')
    .where('date', yesterday.toISOString().split('T')[0])
    .select('user_id', 'action_type', db.raw('COUNT(*) as count'));

  for (const activity of activities) {
    const rule = await getActiveRule(activity.action_type);
    if (!rule) continue;

    const points = rule.points * activity.count;
    await grantPointsImmediately(activity.user_id, activity.action_type, points);
  }
}

// Cronè¨­å®š: æ¯æ—¥åˆå‰2æ™‚å®Ÿè¡Œ
// 0 2 * * * node scripts/calculate-points-daily.js
```

---

### 3. ãƒãƒƒã‚¸åŸºç›¤

#### ã‚µãƒ¼ãƒãƒ¼å´å®Ÿè£…

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**
```sql
-- ãƒãƒƒã‚¸å®šç¾©ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE badge_definitions (
  badge_id VARCHAR(50) PRIMARY KEY,
  name VARCHAR(100),
  description TEXT,
  image_url VARCHAR(255),
  category VARCHAR(50), -- 'visit', 'workout', 'body_composition', 'special'
  rarity VARCHAR(20), -- 'common', 'rare', 'epic', 'legendary'
  condition_type VARCHAR(50), -- 'visit_count', 'workout_count', 'streak', etc.
  condition_value INT,
  is_active BOOLEAN DEFAULT TRUE,
  display_order INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒƒã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE user_badges (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id VARCHAR(255),
  badge_id VARCHAR(50),
  earned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  is_new BOOLEAN DEFAULT TRUE,
  UNIQUE KEY unique_user_badge (user_id, badge_id),
  INDEX idx_user_id (user_id)
);
```

#### APIè¨­è¨ˆ

**ãƒãƒƒã‚¸å®šç¾©å–å¾—API**
```
GET /api/v1/badges
Query: category, rarity
Response:
{
  "badges": [
    {
      "badgeId": "visit_10",
      "name": "10å›æ¥é¤¨",
      "description": "FURDIã«10å›æ¥é¤¨ã—ã¾ã—ãŸ",
      "imageUrl": "https://cdn.example.com/badges/visit_10.png",
      "category": "visit",
      "rarity": "common",
      "conditionType": "visit_count",
      "conditionValue": 10
    }
  ]
}
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒƒã‚¸å–å¾—API**
```
GET /api/v1/users/{userId}/badges
Response:
{
  "earnedBadges": [
    {
      "badgeId": "visit_10",
      "earnedAt": "2025-03-01T10:00:00Z",
      "isNew": false
    }
  ],
  "totalCount": 15,
  "newCount": 2
}
```

**ãƒãƒƒã‚¸ç²å¾—ãƒã‚§ãƒƒã‚¯APIï¼ˆå†…éƒ¨ç”¨ï¼‰**
```
POST /api/v1/internal/badges/check
Body:
{
  "userId": "string",
  "actionType": "string"
}
Response:
{
  "newBadges": [
    {
      "badgeId": "visit_10",
      "name": "10å›æ¥é¤¨"
    }
  ]
}
```

#### ãƒãƒƒã‚¸ç®¡ç†ç”»é¢ï¼ˆWebç®¡ç†å´ï¼‰

**æ©Ÿèƒ½**
- [ ] ãƒãƒƒã‚¸å®šç¾©ã®è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- [ ] ãƒãƒƒã‚¸ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»å·®ã—æ›¿ãˆ
- [ ] ãƒãƒƒã‚¸ã‚«ãƒ†ã‚´ãƒªã®ç®¡ç†
- [ ] ãƒãƒƒã‚¸ç²å¾—æ¡ä»¶ã®è¨­å®š
- [ ] ãƒãƒƒã‚¸è¡¨ç¤ºé †ã®å¤‰æ›´
- [ ] ãƒãƒƒã‚¸ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡ã‚Šæ›¿ãˆ

**ç”»åƒç®¡ç†**
- CDNä½¿ç”¨ï¼ˆCloudFront / Cloud CDNï¼‰
- ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: PNGï¼ˆé€éå¯¾å¿œï¼‰ã€SVG
- ã‚µã‚¤ã‚º: 128Ã—128pxï¼ˆ@2x: 256Ã—256pxï¼‰
- å‘½åè¦å‰‡: `{category}_{achievement}.png`

---

### 4. é€£æºåŸºç›¤

#### æ–°Pixé€£æº

**èªè¨¼ãƒ•ãƒ­ãƒ¼**
```mermaid
sequenceDiagram
    participant User
    participant App
    participant NewPixAPI
    participant AppBackend

    User->>App: ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
    App->>NewPixAPI: OAuthèªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    NewPixAPI->>User: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è¡¨ç¤º
    User->>NewPixAPI: èªè¨¼æƒ…å ±å…¥åŠ›
    NewPixAPI->>App: èªè¨¼ã‚³ãƒ¼ãƒ‰è¿”å´
    App->>AppBackend: èªè¨¼ã‚³ãƒ¼ãƒ‰é€ä¿¡
    AppBackend->>NewPixAPI: ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›
    NewPixAPI->>AppBackend: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³è¿”å´
    AppBackend->>App: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹
```

**ãƒ‡ãƒ¼ã‚¿åŒæœŸAPI**
```
GET /api/v1/integrations/new-pix/workouts
Headers: Authorization: Bearer {token}
Response:
{
  "workouts": [
    {
      "workoutId": "string",
      "date": "2025-03-01",
      "duration": 30,
      "calories": 200,
      "exercises": [...]
    }
  ]
}
```

#### Q.Pixé€£æº

**åº—èˆ—ã”ã¨ã®å¯¾å¿œç®¡ç†**
```sql
-- åº—èˆ—ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE stores (
  store_id VARCHAR(50) PRIMARY KEY,
  store_name VARCHAR(100),
  has_qpix BOOLEAN DEFAULT FALSE,
  qpix_api_url VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åº—èˆ—ç´ä»˜ã‘ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE user_stores (
  user_id VARCHAR(255),
  store_id VARCHAR(50),
  is_primary BOOLEAN DEFAULT FALSE,
  PRIMARY KEY (user_id, store_id)
);
```

**æ¨©é™ãƒã‚§ãƒƒã‚¯**
```javascript
async function canSyncQPix(userId) {
  const userStore = await db('user_stores')
    .join('stores', 'user_stores.store_id', 'stores.store_id')
    .where('user_stores.user_id', userId)
    .where('user_stores.is_primary', true)
    .first();

  return userStore && userStore.has_qpix;
}
```

#### ã‚¿ãƒ‹ã‚¿é€£æº

**OAuthå®Ÿè£…**
```javascript
// ã‚¿ãƒ‹ã‚¿OAuthè¨­å®š
const TANITA_OAUTH_CONFIG = {
  clientId: process.env.TANITA_CLIENT_ID,
  clientSecret: process.env.TANITA_CLIENT_SECRET,
  redirectUri: 'myfurdi://oauth/tanita/callback',
  authUrl: 'https://www.healthplanet.jp/oauth/auth',
  tokenUrl: 'https://www.healthplanet.jp/oauth/token'
};

// ãƒ‡ãƒ¼ã‚¿å–å¾—
async function getTanitaData(userId) {
  const token = await getStoredToken(userId, 'tanita');
  if (!token) return null;

  const response = await fetch('https://www.healthplanet.jp/status/innerscan.json', {
    headers: {
      'Authorization': `Bearer ${token.access_token}`
    }
  });

  return response.json();
}
```

---

### 5. èªè¨¼ãƒ»æ¨©é™ç®¡ç†

#### èªè¨¼åŸºç›¤

**JWTå®Ÿè£…**
```javascript
const jwt = require('jsonwebtoken');

// ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
function generateToken(userId, expiresIn = '7d') {
  return jwt.sign(
    { userId, iat: Math.floor(Date.now() / 1000) },
    process.env.JWT_SECRET,
    { expiresIn }
  );
}

// ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
function generateRefreshToken(userId) {
  return jwt.sign(
    { userId, type: 'refresh' },
    process.env.JWT_REFRESH_SECRET,
    { expiresIn: '30d' }
  );
}

// ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
function authenticateToken(req, res, next) {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) return res.sendStatus(401);

  jwt.verify(token, process.env.JWT_SECRET, (err, user) => {
    if (err) return res.sendStatus(403);
    req.user = user;
    next();
  });
}
```

#### SSOå®Ÿè£…

**Apple Sign Inï¼ˆiOSï¼‰**
```swift
// iOSå´å®Ÿè£…
import AuthenticationServices

func handleAppleSignIn() {
  let request = ASAuthorizationAppleIDProvider().createRequest()
  request.requestedScopes = [.fullName, .email]

  let controller = ASAuthorizationController(authorizationRequests: [request])
  controller.delegate = self
  controller.presentationContextProvider = self
  controller.performRequests()
}

func authorizationController(controller: ASAuthorizationController,
                            didCompleteWithAuthorization authorization: ASAuthorization) {
  if let appleIDCredential = authorization.credential as? ASAuthorizationAppleIDCredential {
    let userIdentifier = appleIDCredential.user
    let identityToken = appleIDCredential.identityToken

    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é€ä¿¡ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹
    sendToBackend(userIdentifier, identityToken)
  }
}
```

**Google SSO**
```javascript
// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´æ¤œè¨¼
const { OAuth2Client } = require('google-auth-library');
const client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);

async function verifyGoogleToken(token) {
  const ticket = await client.verifyIdToken({
    idToken: token,
    audience: process.env.GOOGLE_CLIENT_ID
  });

  const payload = ticket.getPayload();
  return {
    userId: payload['sub'],
    email: payload['email'],
    name: payload['name']
  };
}
```

#### æ©Ÿç¨®å¤‰ãƒ»ãƒ‡ãƒ¼ã‚¿å¼•ãç¶™ã

**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**
```sql
-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE user_backups (
  user_id VARCHAR(255) PRIMARY KEY,
  backup_data JSON, -- ãƒã‚¤ãƒ³ãƒˆã€ãƒãƒƒã‚¸ã€è¨­å®šãªã©
  last_backup_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  device_id VARCHAR(255),
  platform VARCHAR(20) -- 'ios', 'android'
);
```

**å¾©å…ƒAPI**
```
POST /api/v1/users/{userId}/restore
Body:
{
  "deviceId": "string",
  "platform": "ios"
}
Response:
{
  "points": {...},
  "badges": [...],
  "settings": {...}
}
```

---

### 6. ç®¡ç†ãƒ»åˆ†æ

#### Firebase Analyticsè¨­å®š

**ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©**
```javascript
// ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ä¾‹
logEvent('screen_view', {
  screen_name: 'HomeScreen',
  screen_class: 'HomeScreen'
});

logEvent('badge_earned', {
  badge_id: 'visit_10',
  badge_category: 'visit',
  badge_rarity: 'common'
});

logEvent('point_earned', {
  action_type: 'visit',
  points: 10
});

logEvent('integration_connected', {
  service: 'tanita'
});
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š**
```javascript
setUserProperties({
  user_tier: 'gold',
  primary_store: 'store_001',
  total_visits: 50
});
```

#### ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**å¿…è¦ãªæŒ‡æ¨™**
- KPIï¼ˆé‡è¦æ¥­ç¸¾è©•ä¾¡æŒ‡æ¨™ï¼‰
  - DAU / MAU
  - ç¶™ç¶šç‡ï¼ˆD1 / D7 / D30ï¼‰
  - LTVï¼ˆé¡§å®¢ç”Ÿæ¶¯ä¾¡å€¤ï¼‰

- æ©Ÿèƒ½åˆ¥åˆ©ç”¨ç‡
  - ç”»é¢åˆ¥ã‚¢ã‚¯ã‚»ã‚¹æ•°
  - ãƒãƒƒã‚¸ç²å¾—ç‡
  - é€£æºã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ç‡

- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†æ
  - åº—èˆ—åˆ¥ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç‡
  - ä¼šå“¡ç¨®åˆ¥åˆ¥åˆ©ç”¨çŠ¶æ³
  - ãƒ‡ãƒã‚¤ã‚¹OSåˆ¥åˆ†å¸ƒ

**ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Ÿè£…**
- Google Data Studio / Looker Studio
- ã¾ãŸã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆReact + Chart.jsï¼‰

---

### 7. ã‚µãƒ¼ãƒãƒ¼å´ç®¡ç†åŸºç›¤

#### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆCMSï¼‰

**ãŠçŸ¥ã‚‰ã›ç®¡ç†**
```sql
CREATE TABLE announcements (
  id INT PRIMARY KEY AUTO_INCREMENT,
  title VARCHAR(255),
  content TEXT,
  image_url VARCHAR(255),
  category VARCHAR(50), -- 'news', 'maintenance', 'event'
  priority INT, -- 1: é«˜, 2: ä¸­, 3: ä½
  start_date DATETIME,
  end_date DATETIME,
  target_segment VARCHAR(50), -- 'all', 'ios', 'android', 'store_xxx'
  is_push_notification BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†**
```sql
CREATE TABLE events (
  event_id VARCHAR(50) PRIMARY KEY,
  event_name VARCHAR(100),
  description TEXT,
  banner_image_url VARCHAR(255),
  start_date DATETIME,
  end_date DATETIME,
  event_type VARCHAR(50), -- 'challenge', 'campaign', 'special'
  config JSON, -- ã‚¤ãƒ™ãƒ³ãƒˆå›ºæœ‰ã®è¨­å®š
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥

**Firebase Cloud Messagingï¼ˆFCMï¼‰è¨­å®š**
```javascript
const admin = require('firebase-admin');

// é€šçŸ¥é€ä¿¡
async function sendPushNotification(userId, title, body, data = {}) {
  const tokens = await getUserDeviceTokens(userId);

  const message = {
    notification: {
      title: title,
      body: body
    },
    data: data,
    tokens: tokens
  };

  const response = await admin.messaging().sendMulticast(message);
  console.log(`${response.successCount} notifications sent successfully`);
}

// ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¿¡
async function sendSegmentedNotification(segment, title, body) {
  const condition = buildCondition(segment); // 'store_001' in topics

  const message = {
    notification: { title, body },
    condition: condition
  };

  await admin.messaging().send(message);
}
```

---

## ãƒ•ã‚§ãƒ¼ã‚º2ï¼šé‹ç”¨æ‹¡å¼µ

### 1. GameFié‹ç”¨

#### ãƒŸãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**
```sql
CREATE TABLE missions (
  mission_id VARCHAR(50) PRIMARY KEY,
  mission_name VARCHAR(100),
  description TEXT,
  mission_type VARCHAR(20), -- 'daily', 'weekly', 'monthly', 'season'
  condition_type VARCHAR(50),
  condition_value INT,
  reward_points INT,
  start_date DATETIME,
  end_date DATETIME,
  is_active BOOLEAN DEFAULT TRUE
);

CREATE TABLE user_missions (
  user_id VARCHAR(255),
  mission_id VARCHAR(50),
  progress INT DEFAULT 0,
  is_completed BOOLEAN DEFAULT FALSE,
  completed_at TIMESTAMP NULL,
  PRIMARY KEY (user_id, mission_id)
);
```

#### ã‚¬ãƒãƒ£ç®¡ç†

**ç¢ºç‡è¨­å®š**
```sql
CREATE TABLE gacha_pools (
  pool_id VARCHAR(50) PRIMARY KEY,
  pool_name VARCHAR(100),
  start_date DATETIME,
  end_date DATETIME,
  cost_points INT,
  is_active BOOLEAN DEFAULT TRUE
);

CREATE TABLE gacha_items (
  item_id VARCHAR(50) PRIMARY KEY,
  pool_id VARCHAR(50),
  item_name VARCHAR(100),
  item_type VARCHAR(50), -- 'badge', 'wallpaper', 'points'
  rarity VARCHAR(20),
  probability DECIMAL(5, 4), -- 0.0001 ã€œ 1.0000
  value INT
);

-- ç¢ºç‡ã®åˆè¨ˆãŒ1.0ã«ãªã‚‹ã“ã¨ã‚’ä¿è¨¼
```

**ã‚¬ãƒãƒ£å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯**
```javascript
async function executeGacha(userId, poolId) {
  // ãƒã‚¤ãƒ³ãƒˆãƒã‚§ãƒƒã‚¯
  const user = await getUser(userId);
  const pool = await getGachaPool(poolId);

  if (user.availablePoints < pool.costPoints) {
    throw new Error('Insufficient points');
  }

  // ã‚¢ã‚¤ãƒ†ãƒ æŠ½é¸
  const items = await getGachaItems(poolId);
  const result = weightedRandom(items);

  // ãƒã‚¤ãƒ³ãƒˆæ¸›ç®—
  await deductPoints(userId, pool.costPoints);

  // ã‚¢ã‚¤ãƒ†ãƒ ä»˜ä¸
  await grantItem(userId, result);

  // å±¥æ­´è¨˜éŒ²
  await logGachaHistory(userId, poolId, result);

  return result;
}

function weightedRandom(items) {
  const random = Math.random();
  let cumulativeProbability = 0;

  for (const item of items) {
    cumulativeProbability += item.probability;
    if (random <= cumulativeProbability) {
      return item;
    }
  }

  return items[items.length - 1]; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
}
```

---

### 2. ãƒ©ãƒ³ã‚¯ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰

#### ãƒ©ãƒ³ã‚¯åˆ¤å®šãƒãƒƒãƒ

**æ—¥æ¬¡ãƒãƒƒãƒå‡¦ç†**
```javascript
async function updateUserRanks() {
  const users = await db('user_points').select('user_id', 'total_points');

  for (const user of users) {
    const newRank = determineRank(user.total_points);
    const currentRank = await getCurrentRank(user.user_id);

    if (newRank !== currentRank) {
      await updateRank(user.user_id, newRank);

      // ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—é€šçŸ¥
      if (isRankUp(currentRank, newRank)) {
        await sendPushNotification(
          user.user_id,
          'ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ï¼',
          `${newRank}ãƒ©ãƒ³ã‚¯ã«æ˜‡æ ¼ã—ã¾ã—ãŸï¼`
        );
      }
    }
  }
}

function determineRank(points) {
  if (points >= 10000) return 'Platinum';
  if (points >= 5000) return 'Gold';
  if (points >= 1000) return 'Silver';
  return 'Bronze';
}
```

#### ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰é›†è¨ˆ

**é€±æ¬¡é›†è¨ˆå‡¦ç†**
```sql
-- é€±æ¬¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE weekly_leaderboard (
  week_start_date DATE,
  user_id VARCHAR(255),
  points_earned INT,
  rank INT,
  PRIMARY KEY (week_start_date, user_id),
  INDEX idx_rank (week_start_date, rank)
);

-- é›†è¨ˆå‡¦ç†ï¼ˆæ¯é€±æœˆæ›œæ—¥åˆå‰2æ™‚å®Ÿè¡Œï¼‰
INSERT INTO weekly_leaderboard (week_start_date, user_id, points_earned, rank)
SELECT
  DATE_SUB(CURDATE(), INTERVAL WEEKDAY(CURDATE()) DAY) as week_start_date,
  user_id,
  SUM(points) as points_earned,
  RANK() OVER (ORDER BY SUM(points) DESC) as rank
FROM point_history
WHERE created_at >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)
GROUP BY user_id;
```

---

### 3. ã‚¹ãƒãƒ¼ãƒˆã‚¦ã‚©ãƒƒãƒé€£æº

#### Apple Healthé€£æº

**ãƒ‡ãƒ¼ã‚¿åŒæœŸå‡¦ç†**
```swift
// iOS HealthKitçµ±åˆ
import HealthKit

func syncHealthData() {
  let healthStore = HKHealthStore()

  let stepType = HKQuantityType.quantityType(forIdentifier: .stepCount)!
  let query = HKStatisticsQuery(quantityType: stepType,
                                quantitySamplePredicate: nil,
                                options: .cumulativeSum) { _, result, error in
    guard let result = result, let sum = result.sumQuantity() else { return }
    let steps = sum.doubleValue(for: HKUnit.count())

    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é€ä¿¡
    self.sendToBackend(steps: Int(steps))
  }

  healthStore.execute(query)
}
```

---

### 4. DNAæ¤œæŸ»QAæ©Ÿèƒ½

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIçµ±åˆ

**PHP APIã¨ã®é€£æº**
```javascript
// Node.js â†’ PHP API
async function queryDNAInsights(userId, question) {
  const dnaData = await getDNAResults(userId);

  const response = await fetch(process.env.DNA_QA_API_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${process.env.DNA_API_KEY}`
    },
    body: JSON.stringify({
      userId: userId,
      dnaData: dnaData,
      question: question
    })
  });

  return response.json();
}
```

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

**ç›£æŸ»ãƒ­ã‚°**
```sql
CREATE TABLE dna_access_logs (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id VARCHAR(255),
  accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  access_type VARCHAR(50), -- 'view', 'qa_query'
  ip_address VARCHAR(45),
  user_agent TEXT,
  request_data JSON
);
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **è¨€èª**: Node.js (Express) / PHPï¼ˆæ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ é€£æºï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: MySQL 8.0 / PostgreSQL
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redis
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: AWS S3 / Google Cloud Storage
- **CDN**: CloudFront / Cloud CDN

### ã‚¤ãƒ³ãƒ•ãƒ©
- **ã‚¯ãƒ©ã‚¦ãƒ‰**: AWS / Google Cloud Platform
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Docker / Kubernetesï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- **CI/CD**: GitHub Actions / GitLab CI

### ç›£è¦–ãƒ»é‹ç”¨
- **APM**: New Relic / Datadog
- **ãƒ­ã‚°**: CloudWatch / Stackdriver
- **ã‚¨ãƒ©ãƒ¼è¿½è·¡**: Sentry
- **ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹**: Firebase Analytics / Google Analytics 4

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

### 1. ãƒ‡ãƒ¼ã‚¿ä¿è­·
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æš—å·åŒ–ï¼ˆat restï¼‰
- [ ] é€šä¿¡æš—å·åŒ–ï¼ˆTLS 1.3ï¼‰
- [ ] å€‹äººæƒ…å ±ã®ãƒã‚¹ã‚­ãƒ³ã‚°
- [ ] å®šæœŸçš„ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

### 2. èªè¨¼ãƒ»èªå¯
- [ ] JWT ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
- [ ] ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
- [ ] ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–

### 3. API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆRate Limitingï¼‰
- [ ] CORS è¨­å®š
- [ ] APIã‚­ãƒ¼ç®¡ç†
- [ ] å…¥åŠ›æ¤œè¨¼ãƒ»ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

### 4. ç›£æŸ»ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹
- [ ] ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è¨˜éŒ²
- [ ] å€‹äººæƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»
- [ ] GDPR / å€‹äººæƒ…å ±ä¿è­·æ³•å¯¾å¿œ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ï¼ˆå¹´æ¬¡ï¼‰

---

## ç›£è¦–ãƒ»é‹ç”¨ä½“åˆ¶

### 1. ç›£è¦–é …ç›®

**ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–**
- ã‚µãƒ¼ãƒãƒ¼CPU / ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ•°ãƒ»ã‚¯ã‚¨ãƒªæ€§èƒ½
- APIå¿œç­”æ™‚é–“
- ã‚¨ãƒ©ãƒ¼ç‡

**ã‚¢ãƒ—ãƒªç›£è¦–**
- ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ç‡
- ANRï¼ˆApplication Not Respondingï¼‰ç‡
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ç‡
- ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»é‡

### 2. ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

**Criticalï¼ˆå³æ™‚å¯¾å¿œï¼‰**
- ã‚µãƒ¼ãƒ“ã‚¹ãƒ€ã‚¦ãƒ³
- ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ç‡ > 5%
- APIå¿œç­”æ™‚é–“ > 5ç§’

**Highï¼ˆ1æ™‚é–“ä»¥å†…ï¼‰**
- ã‚¨ãƒ©ãƒ¼ç‡ > 3%
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

**Mediumï¼ˆå½“æ—¥ä¸­ï¼‰**
- APIå¿œç­”æ™‚é–“ > 1ç§’
- ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ç‡ > 2%

### 3. ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ä½“åˆ¶
- å¹³æ—¥: 9:00ã€œ18:00ï¼ˆé€šå¸¸ã‚µãƒãƒ¼ãƒˆï¼‰
- ä¼‘æ—¥ãƒ»å¤œé–“: ã‚ªãƒ³ã‚³ãƒ¼ãƒ«å¯¾å¿œï¼ˆCritical ã®ã¿ï¼‰

---

## ãƒªãƒªãƒ¼ã‚¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### Phase1ï¼ˆ3æœˆä¸Šæ—¬ãƒªãƒªãƒ¼ã‚¹ï¼‰

| Week | ã‚¿ã‚¹ã‚¯ | æ‹…å½“ | çŠ¶æ…‹ |
|------|--------|------|------|
| 1-2 | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åŸºç›¤æ§‹ç¯‰ | ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒ  | äºˆå®š |
| 3-4 | APIå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ | ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒ  | äºˆå®š |
| 5-6 | ç¤¾å†…ãƒ™ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ | å…¨ä½“ | äºˆå®š |
| 7-8 | é™å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ã‚¹ãƒˆ | å…¨ä½“ | äºˆå®š |
| 9-10 | æœ€çµ‚èª¿æ•´ãƒ»å¯©æŸ»ç”³è«‹ | å…¨ä½“ | äºˆå®š |
| 11 | ã‚¹ãƒˆã‚¢å…¬é–‹ | ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒ  | äºˆå®š |

---

**æ›´æ–°å±¥æ­´**

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ›´æ–°å†…å®¹ |
|-----|----------|---------|
| 2025-10-09 | 1.0.0 | åˆç‰ˆä½œæˆï¼ˆè­°äº‹éŒ²ã‹ã‚‰ã®æ•´ç†ï¼‰ |
