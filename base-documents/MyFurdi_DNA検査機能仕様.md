# MyFurdi DNA検査結果表示機能 仕様書

## 概要

外部DNA検査サービスと連携し、フィットネスに特化した遺伝子検査結果をアプリ内で表示・活用する機能です。

### 目的
- 遺伝的特性に基づいた最適なトレーニングプランの提案
- 栄養指導のパーソナライゼーション
- 怪我予防と効果的な運動習慣の構築

---

## 連携する外部サービス

### 採用サービス: IDENSIL（イデンシル）
- **提供会社**: 株式会社グリスタ
- **公式サイト**: https://idensil.jp/
- **特徴**:
  - 業務用に特化した高精度遺伝子分析サービス
  - 32個の遺伝子型を分析
  - フィットネス・スポーツに特化
  - 病院の臨床検査で使用される先端機器MassARRAY®で解析
  - 順天堂大学のスポーツ遺伝学・行動遺伝学の研究者が監修

### 検査方法
- 綿棒で口の中のほほの内側をこすって検体採取
- 痛みなし、1分程度で完了
- 検査結果はPDFレポートで提供

### 連携方式（想定）
以下の2つの方式を検討中：

#### 方式A: IDENSIL API連携
- ユーザーIDをキーにIDENSILシステムから直接PDF取得
- リアルタイムでデータ同期
- OAuth 2.0またはAPI Key認証

#### 方式B: 新PIX経由のPDF保持
- IDENSILから受け取ったPDFを新PIXサーバーに保存
- ユーザーIDと紐付けて管理
- アプリからは新PIX経由でPDFダウンロード

**注**: 最終的な連携方式は、IDENSILとの契約内容および新PIXの仕様確定後に決定

---

## 表示する遺伝子項目（フィットネス関連）

### 1. 筋肉タイプ
- **ACTN3遺伝子** (α-アクチニン-3)
  - RR型: 速筋優位（瞬発力）
  - RX型: バランス型
  - XX型: 遅筋優位（持久力）

### 2. 持久力関連
- **ACE遺伝子** (アンジオテンシン変換酵素)
  - II型: 持久力高
  - ID型: バランス型
  - DD型: 瞬発力高

### 3. 代謝関連
- **FTO遺伝子**: 肥満傾向
- **PPARG遺伝子**: 脂肪燃焼効率
- **ADRB2遺伝子**: 基礎代謝
- **UCP1遺伝子**: 体温調節・脂肪燃焼

### 4. 栄養素代謝
- **糖質代謝**: GLUT4, IRS1遺伝子
- **脂質代謝**: APOA5, LPL遺伝子
- **タンパク質利用**: mTOR関連遺伝子

### 5. 運動効果
- **PPARGC1A遺伝子**: 運動効果の出やすさ
- **IL6遺伝子**: 筋肉増強効果

### 6. 怪我リスク
- **COL1A1遺伝子**: 腱・靭帯の強度
- **COL5A1遺伝子**: 関節柔軟性

### 7. 疲労・回復
- **CRP遺伝子**: 炎症反応
- **SOD2遺伝子**: 抗酸化能力
- **BDNF遺伝子**: 神経回復力

---

## 画面構成

### DNA検査結果画面

#### ヘッダー部
- タイトル: "DNA検査結果"
- 検査日: "2024年8月15日実施"
- 検査機関: "IDENSIL（イデンシル）"
- PDFダウンロードボタン: 詳細レポートをダウンロード

#### タブ構成
1. **総合評価タブ**
   - 体質スコア（レーダーチャート）
   - 遺伝的強み・弱み
   - おすすめトレーニングタイプ

2. **筋肉タイプタブ**
   - 速筋/遅筋比率
   - 適した運動強度
   - トレーニング推奨

3. **代謝タブ**
   - 基礎代謝傾向
   - 栄養素別代謝効率
   - 食事アドバイス

4. **怪我リスクタブ**
   - 関節・腱のリスク評価
   - 予防エクササイズ
   - ストレッチ推奨

5. **詳細データタブ**
   - 全遺伝子項目リスト（IDENSIL 32項目）
   - 科学的根拠リンク
   - IDENSIL完全レポートPDFダウンロード

---

## UI/UX設計

### デザインコンセプト
- **科学的な信頼感**: ブルー系グラデーション
- **わかりやすさ**: 視覚的なチャート・アイコン
- **行動につながる**: 具体的なアドバイス表示

### カラーパレット
```
Primary: #2196F3 (DNA Blue)
Secondary: #FF69B4 (Furdi Pink)
Success: #4CAF50 (Green)
Warning: #FF9800 (Orange)
Error: #FF0000 (Red)

Gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%)
```

### コンポーネント

#### 1. DNAスコアカード
- レーダーチャート（6軸）
  - 筋力
  - 持久力
  - 代謝効率
  - 回復力
  - 柔軟性
  - 総合評価

#### 2. 遺伝子項目カード
```
[アイコン] 遺伝子名
タイプ: XX型
評価: ★★★★☆
説明: あなたは持久力に優れた遺伝的特性を持っています
```

#### 3. おすすめカード
```
💡 あなたにおすすめ
- 有酸素運動を中心に
- 長時間の低〜中強度トレーニング
- マラソン・サイクリング・水泳
```

#### 4. リスクアラート
```
⚠️ 注意が必要
関節の柔軟性が低い傾向があります
→ ストレッチを入念に行いましょう
→ 推奨ストレッチ動画を見る
```

---

## データ構造

### DNA Result Model
```typescript
interface DNAResult {
  id: string;
  userId: string;
  testDate: string;
  provider: string; // "GeneQuest" | "MYCODE" | etc.

  summary: {
    overallScore: number; // 0-100
    strengthType: "power" | "endurance" | "balanced";
    metabolismType: "fast" | "normal" | "slow";
    injuryRisk: "low" | "medium" | "high";
  };

  genes: {
    muscleType: {
      ACTN3: "RR" | "RX" | "XX";
      evaluation: number; // 0-5
      description: string;
    };
    endurance: {
      ACE: "II" | "ID" | "DD";
      evaluation: number;
      description: string;
    };
    metabolism: {
      FTO: GeneResult;
      PPARG: GeneResult;
      ADRB2: GeneResult;
    };
    injury: {
      COL1A1: GeneResult;
      COL5A1: GeneResult;
    };
    recovery: {
      CRP: GeneResult;
      SOD2: GeneResult;
    };
  };

  recommendations: {
    training: string[];
    nutrition: string[];
    recovery: string[];
    cautions: string[];
  };
}

interface GeneResult {
  type: string;
  evaluation: number; // 0-5 stars
  description: string;
  impact: "high" | "medium" | "low";
}
```

### API Endpoints

#### 方式A: IDENSIL API連携の場合
```typescript
// DNA検査結果取得（IDENSIL APIから）
GET /api/dna/results/:userId
// IDENSILのユーザーIDと紐付けて結果を取得

// IDENSIL PDFダウンロード
GET /api/dna/pdf/:userId
// IDENSILから直接PDFを取得してストリーミング

// IDENSIL連携設定
POST /api/dna/connect
{
  userId: string;
  idensilUserId: string;
  authToken?: string;
}
```

#### 方式B: 新PIX経由のPDF保持の場合
```typescript
// DNA検査結果取得（新PIXから）
GET /api/dna/results/:userId
// 新PIXに保存されたデータを取得

// PDF取得（新PIXから）
GET /api/dna/pdf/:userId
// 新PIXサーバーに保存されたPDFをダウンロード

// PDFアップロード（IDENSIL→新PIX）
POST /api/dna/upload
{
  userId: string;
  idensilUserId: string;
  pdfFile: File;
}
```

#### 共通API
```typescript
// おすすめトレーニング取得（DNA結果ベース）
GET /api/dna/recommendations/:userId

// DNA検査状態確認
GET /api/dna/status/:userId
// → { hasTest: boolean, testDate?: string, pdfAvailable: boolean }
```

---

## 画面仕様詳細

### 総合評価タブ

#### レーダーチャート
- サイズ: 300×300px
- 6軸評価
  - 筋力: 0-100
  - 持久力: 0-100
  - 代謝: 0-100
  - 回復: 0-100
  - 柔軟性: 0-100
  - 総合: 平均値

#### 体質タイプカード
```
[大きなアイコン]
あなたの体質タイプ

持久力優位型
遺伝的に長時間の運動に向いています

★ 強み
- 疲れにくい
- 有酸素運動が得意
- 脂肪燃焼効率が高い

⚠️ 弱み
- 瞬発力は平均的
- 筋肥大しにくい
```

#### おすすめトレーニングカード
```
💪 おすすめトレーニング

1. 有酸素運動メイン
   ランニング・サイクリング・水泳

2. 中強度インターバル
   HIIT (週2-3回)

3. 筋トレ
   高回数×低重量

→ あなた専用プランを見る
```

### 筋肉タイプタブ

#### ACTN3遺伝子カード
```
🧬 ACTN3遺伝子
(筋肉タイプ)

検査結果: XX型
評価: ★★★★☆

あなたの特性:
持久力に優れた遺伝的特性
長時間の運動に向いています

科学的根拠:
XX型は遅筋繊維が多く、マラソンランナーに
多く見られるタイプです。

おすすめ:
- 長距離ランニング
- 低〜中強度の長時間運動
- 有酸素運動中心のメニュー
```

#### ACE遺伝子カード
```
🧬 ACE遺伝子
(持久力)

検査結果: II型
評価: ★★★★★

あなたの特性:
非常に高い持久力の遺伝的素質

おすすめ:
- マラソン・トライアスロン
- 長時間の有酸素運動
```

### 代謝タブ

#### 基礎代謝カード
```
🔥 基礎代謝

遺伝的傾向: 標準
ADRB2遺伝子: GG型

1日の推定基礎代謝:
1,350 kcal

特徴:
- 代謝は平均的
- 食事管理が重要
- 運動で効果的に燃焼

アドバイス:
バランスの良い食事と
定期的な運動を心がけましょう
```

#### 栄養素代謝カード（3枚）
```
🍚 糖質代謝
傾向: 標準
推奨: バランス良く摂取

🥑 脂質代謝
傾向: やや低め
推奨: 良質な脂質を選択

🥩 タンパク質利用
傾向: 高い
推奨: 積極的に摂取
```

### 怪我リスクタブ

#### リスク評価カード
```
⚠️ 怪我リスク評価

総合リスク: 中程度

【関節・腱】
COL1A1遺伝子: GT型
リスク: やや高い

【柔軟性】
COL5A1遺伝子: CC型
リスク: 標準

注意点:
- ウォームアップを十分に
- ストレッチを重点的に
- 急な負荷増加を避ける
```

#### 予防エクササイズカード
```
🧘 おすすめ予防策

1. ダイナミックストレッチ
   運動前に10分間
   → 動画を見る

2. 関節可動域トレーニング
   週3回、各10分
   → 動画を見る

3. クールダウン
   運動後に必ず実施
   → 動画を見る
```

### 詳細データタブ

#### 遺伝子リスト
```
IDENSIL 全32項目の検査結果

【筋肉・運動能力】
✓ ACTN3 - 筋肉タイプ: XX型 ★★★★☆
✓ ACE - 持久力: II型 ★★★★★
✓ PPARGC1A - 運動効果: AG型 ★★★☆☆

【代謝】
✓ FTO - 肥満傾向: TT型 ★★★☆☆
✓ PPARG - 脂肪燃焼: CC型 ★★★★☆
✓ ADRB2 - 基礎代謝: GG型 ★★★☆☆

【栄養】
✓ GLUT4 - 糖質代謝: AA型 ★★★☆☆
✓ APOA5 - 脂質代謝: TC型 ★★☆☆☆
...（全32項目表示）

[IDENSIL完全レポートPDFをダウンロード]
📄 詳細な分析結果と科学的根拠が記載された
   IDENSIL公式レポートをダウンロードできます
```

#### PDFダウンロード機能
```
ボタンタップ時の動作:
1. サーバーからPDFを取得
   - 方式A: IDENSILサーバーから直接取得
   - 方式B: 新PIXサーバーから取得
2. ローカルに保存またはプレビュー表示
3. ダウンロード完了通知

ファイル名形式:
IDENSIL_DNA_Report_[ユーザーID]_[検査日].pdf
例: IDENSIL_DNA_Report_12345_20240815.pdf
```

---

## ナビゲーション

### アクセス方法
1. **メニュー画面から**
   - "コンテンツ" → "DNA検査結果"

2. **レポート画面から**
   - "体組成"タブ → "DNA検査を見る"リンク

3. **ホーム画面から**
   - "健康データ"カード → "DNA詳細"

### 遷移フロー
```
Menu/Report/Home
    ↓
DNA Results Screen (総合評価タブ)
    ↓
[Tab切り替え]
- 筋肉タイプタブ
- 代謝タブ
- 怪我リスクタブ
- 詳細データタブ
    ↓
[アクション]
- おすすめプラン作成
- トレーニング動画
- 栄養アドバイス
- PDF詳細レポート
```

---

## 未検査ユーザー向けUI

### 検査未実施の場合

#### 案内カード
```
🧬 IDENSIL DNA検査で最適なトレーニングを

遺伝子検査であなたの体質を知り、
最も効果的な運動・食事方法を見つけましょう

【IDENSIL（イデンシル）とは】
✓ 業務用に特化した高精度遺伝子分析
✓ 32個の遺伝子型を分析
✓ 順天堂大学の専門家が監修
✓ 病院の臨床検査機器で解析

【わかること】
✓ 筋肉タイプ（速筋/遅筋）
✓ 持久力・瞬発力の傾向
✓ 代謝の特性（32項目の詳細分析）
✓ 怪我リスク
✓ 最適なトレーニング方法
✓ 栄養指導のパーソナライズ

【検査方法】
綿棒で口の中を軽くこするだけ
痛みなし、1分で完了

[検査を申し込む] ボタン
→ IDENSIL検査申込み（店舗スタッフにご相談ください）

[すでにIDENSIL検査済みの方]
→ 結果を連携する
```

---

## プライバシー・セキュリティ

### データ保護
- 遺伝子情報は暗号化して保存
- アクセス制限（本人のみ）
- 定期的なデータバックアップ
- GDPR/個人情報保護法準拠

### 同意取得
- 初回利用時に同意画面表示
- 利用目的の明示
- データ削除権の保証

### 第三者提供
- 原則として第三者提供なし
- 統計データのみ匿名化して活用
- ユーザー同意なしの提供禁止

---

## 実装フェーズ

### Phase 1: MVP（最小機能）
- [ ] IDENSIL連携方式の確定（方式A or B）
- [ ] ユーザーID紐付け機能
- [ ] PDFダウンロード機能実装
- [ ] 総合評価タブ表示（IDENSIL 32項目ベース）
- [ ] 基本的な遺伝子項目表示
- [ ] おすすめトレーニング表示

### Phase 2: 機能拡張
- [ ] IDENSIL API完全連携（方式確定後）
- [ ] 全タブ実装（筋肉・代謝・怪我リスク・詳細）
- [ ] 詳細分析・レーダーチャート（32項目対応）
- [ ] パーソナライズドプラン生成
- [ ] PDF自動更新・通知機能

### Phase 3: 高度化
- [ ] AI解析による詳細アドバイス（IDENSIL結果ベース）
- [ ] トレーニング効果の追跡（DNA特性との相関）
- [ ] DNA×実績データの相関分析
- [ ] 専門家コンサルテーション連携
- [ ] 定期的な遺伝子知見アップデート

---

## KPI

### 利用指標
- DNA検査結果登録率
- タブ別閲覧率
- おすすめプラン採用率
- トレーニング動画視聴率

### 成果指標
- DNA情報を活用したユーザーの継続率
- 目標達成率の向上
- 怪我発生率の低下
- ユーザー満足度

---

## 参考資料

### 遺伝子検査サービス
- **[IDENSIL（イデンシル）公式サイト](https://idensil.jp/)** - 採用サービス
- [株式会社グリスタ](https://www.glista.co.jp/) - IDENSIL提供元

### 科学的根拠
- ACTN3と運動能力の関連研究（順天堂大学監修）
- ACE遺伝子と持久力の関係
- 栄養遺伝学の最新研究（IDENSIL 32項目分析）
- MassARRAY®による高精度遺伝子解析技術

### 技術連携
- 新PIXシステム仕様（連携方式確定後に追記予定）
- IDENSIL API仕様書（提供後に追記予定）

---

## 更新履歴

| 日付 | バージョン | 更新内容 |
|-----|----------|---------|
| 2025-10-02 | 1.0.0 | DNA検査結果表示機能 初版作成 |
| 2025-10-23 | 2.0.0 | IDENSILサービス採用に伴う全面改訂。PDFダウンロード機能追加、連携方式2パターン記載、32項目対応 |
